<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« â€” ã‚³ã‚³ã‚¹ã‚¯</title>

  <!-- Flask ã® static å‚ç…§ -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/cocoprofile.css') }}">
</head>
<body>
  <div class="app">

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header-bar">
      <div class="brand" onclick="window.location.href='{{ url_for('timeline') }}'">
        <div class="logo">
          <img src="{{ url_for('static', filename='image/Cocosku_logo2.png') }}" alt="ã‚³ã‚³ã‚¹ã‚¯ ãƒ­ã‚´">
        </div>
        <div class="app-name">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
      </div>

      <a href="{{ url_for('settings') }}" class="settings-link">âš™ï¸ è¨­å®š</a>
    </div>

    <!-- ãƒ•ã‚©ãƒ­ãƒ¼æ•°ãªã© -->
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-count">{{ following_count }}</div>
        <div>ãƒ•ã‚©ãƒ­ãƒ¼</div>
      </div>
      <div class="stat-item">
        <div class="stat-count">{{ follower_count }}</div>
        <div>ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼</div>
      </div>
      <div class="stat-item">
        <div class="stat-count">{{ post_count }}</div>
        <div>æŠ•ç¨¿</div>
      </div>
    </div>

    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤º -->
<div class="profile-card" id="profileDisplay">
  <div class="profile-header">
    <div class="avatar-preview">
      {% if user.avatar_url %}
        <img src="{{ user.avatar_url }}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
      {% else %}
        {{ user.name[0] }}
      {% endif %}
    </div>

    <h3>{{ user.name }}</h3>

    <p id="displayBio" style="text-align:center;color:var(--muted);margin-top:4px;">
      {{ user.bio or "è‡ªå·±ç´¹ä»‹ãªã—" }}
    </p>

    <button class="edit-btn"
      onclick="document.getElementById('profileEdit').style.display='block';
               document.getElementById('profileDisplay').style.display='none';">
      ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç·¨é›†
    </button>
  </div>

  <!-- ğŸ”½ è©³ç´°æƒ…å ±ï¼ˆå…¨éƒ¨è¡¨ç¤ºï¼‰-->
  <div class="profile-details">

    <div class="detail-item"><strong>è¶£å‘³ï¼š</strong> {{ user.hobby or "æœªè¨­å®š" }}</div>
    <div class="detail-item"><strong>ã‚µãƒ¼ã‚¯ãƒ« / éƒ¨æ´»ï¼š</strong> {{ user.circle or "æœªè¨­å®š" }}</div>
    <div class="detail-item"><strong>å­¦éƒ¨ / å­¦ç§‘ / å°‚æ”»ï¼š</strong> {{ user.course or "æœªè¨­å®š" }}</div>
    <div class="detail-item"><strong>å­¦å¹´ï¼š</strong> {{ user.grade or "æœªè¨­å®š" }}</div>
    <div class="detail-item"><strong>è³‡æ ¼ï¼š</strong> {{ user.qualification or "æœªè¨­å®š" }}</div>
    <div class="detail-item"><strong>ä¸€è¨€ã‚³ãƒ¡ãƒ³ãƒˆï¼š</strong> {{ user.comment or "æœªè¨­å®š" }}</div>

  </div>
</div>


    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  -->
<div class="profile-card" id="profileEdit" style="display:none;">
  <h3 style="margin-top:0;">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</h3>

  <form action="{{ url_for('profile_update') }}" method="POST" enctype="multipart/form-data">

    <div class="form-group">
      <label>åå‰ï¼ˆå¿…é ˆï¼‰</label>
      <input type="text" name="name" value="{{ user.name }}" required>
    </div>

    <div class="form-group">
      <label>è‡ªå·±ç´¹ä»‹</label>
      <textarea name="bio">{{ user.bio }}</textarea>
    </div>

    <div class="form-group">
      <label>è¶£å‘³</label>
      <input type="text" name="hobby" value="{{ user.hobby }}">
    </div>

    <div class="form-group">
      <label>ã‚µãƒ¼ã‚¯ãƒ« / éƒ¨æ´»</label>
      <input type="text" name="circle" value="{{ user.circle }}">
    </div>

    <div class="form-group">
      <label>å­¦éƒ¨ / å­¦ç§‘ / å°‚æ”»</label>
      <input type="text" name="course" value="{{ user.course }}">
    </div>

    <div class="form-group">
      <label>å­¦å¹´</label>
      <input type="text" name="grade" value="{{ user.grade }}">
    </div>

    <div class="form-group">
      <label>è³‡æ ¼</label>
      <input type="text" name="qualification" value="{{ user.qualification }}">
    </div>

    <div class="form-group">
      <label>ä¸€è¨€ã‚³ãƒ¡ãƒ³ãƒˆ</label>
      <textarea name="comment">{{ user.comment }}</textarea>
    </div>

    <div class="form-group">
      <label>ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒ</label>
      <input type="file" name="avatar" accept="image/*">
    </div>

    <button class="save-btn" type="submit">ä¿å­˜</button>
    <button class="edit-btn" type="button"
      onclick="document.getElementById('profileEdit').style.display='none';
               document.getElementById('profileDisplay').style.display='block';">
      ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    </button>

  </form>
</div>


    <!-- è‡ªåˆ†ã®æŠ•ç¨¿ä¸€è¦§ -->
    <div class="my-posts">
      <h3>è‡ªåˆ†ã®æŠ•ç¨¿</h3>
    
      {% if posts %}
        {% for post in posts %}
          <div class="post-card" data-post-id="{{ post.id }}">
    
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆè‡ªåˆ†ã®åå‰ï¼‰ -->
            <div class="post-header">
              {{ user.name }}
            </div>
    
            <!-- æœ¬æ–‡ -->
            <div class="post-content">
              {{ post.content | replace('\n','<br>') | safe }}
            </div>
    
            <!-- ç”»åƒ -->
            {% if post.image_url %}
              <img src="{{ post.image_url }}" class="post-image">
            {% endif %}
    
            <!-- ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆTLã¨å®Œå…¨ä¸€è‡´ï¼‰ -->
            <div class="post-footer">
    
              <!-- â¤ï¸ ã„ã„ã­ -->
              <button class="like-btn" data-post-id="{{ post.id }}">â¤ï¸</button>
    
              <!-- ã‚«ã‚¦ãƒ³ãƒˆ -->
              <span class="like-count">{{ post.likes | length }}</span>
    
              <!-- ğŸ’¬ ãƒªãƒ—ãƒ©ã‚¤ -->
              <button class="reply-btn" onclick="openReplyModal('{{ post.id }}')">
                ğŸ’¬ ãƒªãƒ—ãƒ©ã‚¤ ({{ post.replies_count | default(0) }})
              </button>
    
              <!-- ğŸ—‘ å‰Šé™¤ -->
              <button class="delete-btn" onclick="confirmDeletePost('{{ post.id }}')">
                ğŸ—‘ å‰Šé™¤
              </button>
    
            </div>
    
            <!-- â–¼ ãƒªãƒ—ãƒ©ã‚¤3ä»¶ã¾ã§ -->
            {% if post.replies %}
              <div class="reply-list">
    
                {% for reply in post.replies[:3] %}
                  <div class="reply-item">
                    <strong>{{ reply.user_name }}</strong>ï¼š
                    <span>{{ reply.content | replace('\n', '<br>') | safe }}</span>
    
                    {% if reply.user_id == user.uid %}
                      <form action="{{ url_for('delete_reply', post_id=post.id, reply_id=reply.id) }}"
                            method="POST" style="display:inline;">
                        <button class="delete-reply-btn">å‰Šé™¤</button>
                      </form>
                    {% endif %}
                  </div>
                {% endfor %}
    
                <!-- â–¼ "ä»–â—‹ä»¶ã®ãƒªãƒ—ãƒ©ã‚¤ã‚’è¦‹ã‚‹" -->
                {% if post.replies | length > 3 %}
                  <div class="reply-toggle" onclick="toggleReplies('{{ post.id }}')" id="toggle-btn-{{ post.id }}">
                    ä»– {{ post.replies|length - 3 }} ä»¶ã®ãƒªãƒ—ãƒ©ã‚¤ã‚’è¦‹ã‚‹
                  </div>
    
                  <div class="reply-hidden" id="hidden-replies-{{ post.id }}" style="display:none;">
                    {% for reply in post.replies[3:] %}
                      <div class="reply-item">
                        <strong>{{ reply.user_name }}</strong>ï¼š
                        <span>{{ reply.content | replace('\n', '<br>') | safe }}</span>
    
                        {% if reply.user_id == user.uid %}
                          <form action="{{ url_for('delete_reply', post_id=post.id, reply_id=reply.id) }}"
                                method="POST" style="display:inline;">
                            <button class="delete-reply-btn">å‰Šé™¤</button>
                          </form>
                        {% endif %}
                      </div>
                    {% endfor %}
    
                    <div class="reply-toggle-close" onclick="toggleReplies('{{ post.id }}')">
                      ä»– {{ post.replies|length - 3 }} ä»¶ã®ãƒªãƒ—ãƒ©ã‚¤ã‚’é–‰ã˜ã‚‹
                    </div>
                  </div>
                {% endif %}
              </div>
            {% endif %}
    
          </div>
        {% endfor %}
      {% else %}
        <p style="text-align:center; color:var(--muted);">
          æŠ•ç¨¿ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚
        </p>
      {% endif %}
    </div>
    
    

    <!-- ãƒŠãƒ“ãƒãƒ¼ -->
    <div class="nav-bar">
      <a href="{{ url_for('timeline') }}" class="nav-item">ğŸ  TL</a>
      <a href="{{ url_for('search') }}" class="nav-item">ğŸ” æ¤œç´¢</a>
      <a href="{{ url_for('notifications') }}" class="nav-item">ğŸ”” é€šçŸ¥</a>
      <a href="{{ url_for('dm') }}" class="nav-item">ğŸ’¬ DM</a>
      <a href="{{ url_for('profile') }}" class="nav-item active">ğŸ‘¤ ãƒ—ãƒ­ãƒ•</a>
      <a href="{{ url_for('calendar') }}" class="nav-item">ğŸ“… äºˆå®š</a>
    </div>
    <script src="{{ url_for('static', filename='js/cocotimeline.js') }}"></script>

  </div>

</body>
</html>
