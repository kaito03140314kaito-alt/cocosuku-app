<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DM â€” ã‚³ã‚³ã‚¹ã‚¯</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/cocochat.css') }}">
</head>
<body>

<div class="app">

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="brand" onclick="location.href='{{ url_for('timeline') }}'">
    <div class="logo">
      <img src="{{ url_for('static', filename='image/Cocosku_logo2.png') }}" alt="">
    </div>
    <div class="app-name">DM</div>
  </div>

  <!-- DMä¸€è¦§ï¼ˆãƒãƒ£ãƒƒãƒˆä¸€è¦§ã®ã¨ãã ã‘è¡¨ç¤ºï¼‰ -->
  {% if not room_id %}
  <div id="dmListScreen">
    <div class="dm-list-container">
  
      {% if rooms %}
        {% for room in rooms %}
          <div class="dm-item" onclick="location.href='/dm/chat/{{ room.other_user.uid }}'">
  
            <div class="dm-avatar">
              {% if room.other_user.get('avatar_url') %}
                <img src="{{ room.other_user.avatar_url }}" class="avatar-img">
              {% else %}
                {{ room.other_user.name[0] }}
              {% endif %}
            </div>
  
            <div class="dm-info">
              <div class="dm-name">{{ room.other_user.name }}</div>
              <div class="dm-preview">
                {{ room.last_message or "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“" }}
              </div>
            </div>
  
          </div>
        {% endfor %}
      {% else %}
        <p style="color:#777; padding:20px;">ã¾ã DMã¯ã‚ã‚Šã¾ã›ã‚“</p>
      {% endif %}
  
    </div>
  </div>
  

  {% endif %}

  <!-- ãƒãƒ£ãƒƒãƒˆç”»é¢ -->
  {% if room_id %}
  <div id="chatScreen" style="display:flex;">
    <div class="chat-header">
      <button class="back-btn" onclick="location.href='{{ url_for('dm_list') }}'">â—€</button>
      <div class="chat-title">{{ other.name }}</div>
    </div>

    <div class="chat-container" id="chatContainer"></div>

    <div class="chat-input-area">
      <input type="text" id="chatInput" class="chat-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›â€¦">
      <button class="send-btn" onclick="sendMessage()">é€ä¿¡</button>
    </div>
  </div>

  <script>
    window.ROOM_ID = "{{ room_id }}";
    window.CURRENT_UID = "{{ current_uid }}";
  </script>
  {% endif %}

</div>

<!-- ãƒŠãƒ“ãƒãƒ¼ -->
<div class="nav-bar">
  <a href="{{ url_for('timeline') }}" class="nav-item">ğŸ  TL</a>
  <a href="{{ url_for('search_page') }}" class="nav-item">ğŸ” æ¤œç´¢</a>
  <a href="{{ url_for('notifications') }}" class="nav-item">ğŸ”” é€šçŸ¥</a>
  <a href="{{ url_for('dm_list') }}" class="nav-item active">ğŸ’¬ DM</a>
  <a href="{{ url_for('profile') }}" class="nav-item">ğŸ‘¤ ãƒ—ãƒ­ãƒ•</a>
  <a href="{{ url_for('calendar_password') }}" class="nav-item">ğŸ“… äºˆå®š</a>
</div>

<script src="{{ url_for('static', filename='js/cocochat.js') }}"></script>
</body>
</html>
