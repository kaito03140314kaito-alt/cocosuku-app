<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ profile.name }} ã•ã‚“ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« â€” ã‚³ã‚³ã‚¹ã‚¯</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/cocootherprofile.css') }}">
</head>
<body>
  <div class="app">

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header-bar">
      <div class="brand" onclick="window.location.href='{{ url_for('timeline') }}'">
        <div class="logo">
          <img src="{{ url_for('static', filename='image/Cocosku_logo2.png') }}" alt="ã‚³ã‚³ã‚¹ã‚¯ ãƒ­ã‚´">
        </div>
        <div class="app-name">{{ profile.name }}</div>
      </div>
    </div>

    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« -->
    <div class="profile-area">

      <!-- ã‚¢ã‚¤ã‚³ãƒ³ -->
      <div class="profile-icon">
        {% if profile.avatar_url %}
          <img src="{{ profile.avatar_url }}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
        {% else %}
          {{ profile.name[0] }}
        {% endif %}
      </div>

      <!-- åå‰ -->
      <div class="profile-name">{{ profile.name }}</div>

      <!-- BIO -->
      <div class="profile-bio">{{ profile.bio or "è‡ªå·±ç´¹ä»‹ãªã—" }}</div>

      <!-- ğŸ”½ ãƒ•ã‚©ãƒ­ãƒ¼ãƒœã‚¿ãƒ³ + DMãƒœã‚¿ãƒ³ -->
      <div class="action-buttons">

        <!-- ãƒ•ã‚©ãƒ­ãƒ¼ãƒœã‚¿ãƒ³ -->
        {% if is_following %}
          <button class="follow-btn following"
            onclick="location.href='{{ url_for('toggle_follow', uid=profile.uid) }}'">
            âœ“ ãƒ•ã‚©ãƒ­ãƒ¼ä¸­
          </button>
        {% else %}
          <button class="follow-btn"
            onclick="location.href='{{ url_for('toggle_follow', uid=profile.uid) }}'">
            ï¼‹ ãƒ•ã‚©ãƒ­ãƒ¼
          </button>
        {% endif %}

        <!-- DMãƒœã‚¿ãƒ³ -->
        <button class="dm-btn" onclick="window.location.href='/dm/chat/{{ profile.uid }}'">
          ğŸ’¬ DM ã‚’é€ã‚‹
        </button>


      </div>

      <!-- è©³ç´°æƒ…å ± -->
      <div class="details-area">
        <div class="detail-row"><div class="detail-key">è¶£å‘³</div><div class="detail-value">{{ profile.hobby or "æœªè¨­å®š" }}</div></div>
        <div class="detail-row"><div class="detail-key">ã‚µãƒ¼ã‚¯ãƒ«</div><div class="detail-value">{{ profile.circle or "æœªè¨­å®š" }}</div></div>
        <div class="detail-row"><div class="detail-key">å­¦éƒ¨/å­¦ç§‘/å°‚æ”»</div><div class="detail-value">{{ profile.course or "æœªè¨­å®š" }}</div></div>
        <div class="detail-row"><div class="detail-key">å­¦å¹´</div><div class="detail-value">{{ profile.grade or "æœªè¨­å®š" }}</div></div>
        <div class="detail-row"><div class="detail-key">è³‡æ ¼</div><div class="detail-value">{{ profile.qualification or "æœªè¨­å®š" }}</div></div>
        <div class="detail-row"><div class="detail-key">ä¸€è¨€ã‚³ãƒ¡ãƒ³ãƒˆ</div><div class="detail-value">{{ profile.comment or "æœªè¨­å®š" }}</div></div>
      </div>

    </div>

    <h3 style="margin-top:0;">æŠ•ç¨¿ä¸€è¦§</h3>

    <div id="userPostsDiv">
      {% if posts %}
        {% for post in posts %}
          <div class="post-card" data-post-id="{{ post.id }}">

            <!-- â–¼ ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="post-header">
              
              <!-- æŠ•ç¨¿è€…ã‚¢ã‚¤ã‚³ãƒ³ -->
              <div class="icon">
                {% if post.user_avatar_url %}
                  <img src="{{ post.user_avatar_url }}" 
                    style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
                {% else %}
                  {{ post.user_name[0] }}
                {% endif %}
              </div>

              <div>
                <div class="user-name">{{ post.user_name }}</div>
                <div class="time">{{ post.created_at_str }}</div>
              </div>

            </div>

            <!-- æœ¬æ–‡ -->
            <div class="post-content">
              {{ post.content | replace('\n','<br>') | safe }}
            </div>

            <!-- ç”»åƒ -->
            {% if post.image_url %}
              <img src="{{ post.image_url }}" class="post-image">
            {% endif %}

            <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
            <div class="post-footer">

              <!-- â¤ï¸ ã„ã„ã­ -->
              <button class="like-btn" data-post-id="{{ post.id }}">â¤ï¸</button>
              <span class="like-count">{{ post.likes | length }}</span>

              <!-- ğŸ’¬ ãƒªãƒ—ãƒ©ã‚¤ -->
              <button class="reply-btn" onclick="openReplyModal('{{ post.id }}')">
                ğŸ’¬ ãƒªãƒ—ãƒ©ã‚¤ ({{ post.replies_count | default(0) }})
              </button>

            </div>

            <!-- â–¼ ãƒªãƒ—ãƒ©ã‚¤ -->
            {% if post.replies %}
              <div class="reply-list">

                {% for reply in post.replies[:3] %}
                  <div class="reply-item">
                    <strong>{{ reply.user_name }}</strong>ï¼š
                    <span>{{ reply.content | replace('\n','<br>') | safe }}</span>
                  </div>
                {% endfor %}

                {% if post.replies | length > 3 %}
                  <div class="reply-toggle"
                    onclick="toggleReplies('{{ post.id }}')"
                    id="toggle-btn-{{ post.id }}">
                    ä»– {{ post.replies|length - 3 }} ä»¶ã®ãƒªãƒ—ãƒ©ã‚¤ã‚’è¦‹ã‚‹
                  </div>

                  <div class="reply-hidden" id="hidden-replies-{{ post.id }}" style="display:none;">
                    {% for reply in post.replies[3:] %}
                      <div class="reply-item">
                        <strong>{{ reply.user_name }}</strong>ï¼š
                        <span>{{ reply.content | replace('\n','<br>') | safe }}</span>
                      </div>
                    {% endfor %}
                    <div class="reply-toggle-close"
                      onclick="toggleReplies('{{ post.id }}')">
                      é–‰ã˜ã‚‹
                    </div>
                  </div>
                {% endif %}

              </div>
            {% endif %}

          </div>
        {% endfor %}

      {% else %}
        <div style="text-align:center; color:var(--muted); margin-top:20px;">
          æŠ•ç¨¿ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚
        </div>
      {% endif %}
    </div>

    <!-- ãƒŠãƒ“ãƒãƒ¼ -->
    <div class="nav-bar">
      <a href="{{ url_for('timeline') }}" class="nav-item">ğŸ  TL</a>
      <a href="{{ url_for('search_page') }}" class="nav-item">ğŸ” æ¤œç´¢</a>
      <a href="{{ url_for('notifications') }}" class="nav-item">ğŸ”” é€šçŸ¥</a>
      <a href="{{ url_for('dm_list') }}" class="nav-item active">ğŸ’¬ DM</a>
      <a href="{{ url_for('profile') }}" class="nav-item active">ğŸ‘¤ ãƒ—ãƒ­ãƒ•</a>
      <a href="{{ url_for('calendar_password') }}" class="nav-item">ğŸ“… äºˆå®š</a>
    </div>

  </div>
  <script src="{{ url_for('static', filename='js/cocoprofile.js') }}"></script>
</body>
</html>
